Adjust selected illumination laser intensity
============================================

Necessity
---------
Changing the laser intensity of a channel in Metamorph 7 is cumbersome:

1.  Open the "Devices > Configure Illumination" window
2.  Find the slider from the list of all device properties
3.  Edit the value, and click "Add / Replace"
4.  Confirm overwriting the existing value

Solution
--------
Metmorph doesn't allow you to record values to an illumination using journals.
Thus the workaround is to completely bypass saving the laser intensity in the
illumination and use an INI file.  Values are read from the INI file by enabling
"Run journal when changing illumination setting" for each laser illumination.

Journals here require the user only to have their illumination of choice
in the drop down menu, run `set_intensity.jnl` and set the single slider in
the modal window.  The journal automatically "knows" what laser wavelength
you want to edit by reading the last 3 digits of the illumination name.

Warning!
--------
Images and experiments will not show laser powers.

Possible workarounds:

1.  Append INI file information to the image or experiment "custom" metadata field
    (assuming such a thing exists)
2.  Copy the INI file to the location where the image or experiment files are saved

Installation
------------
1.  Add buttons `set_intensity.jnl` and `show_values.jnl` to the journal taskbar
    or drop-in toolbar
2.  Rename all laser channels which this journal should operate on
    have their laser wavelength to be edited set to the last 3 digits
    of the channel name like "Confocal 488" or "TIRF640"
3.  Check "Run journal when changing illumination setting" for each laser
    illumination.
4.  (Optional, but required for next step) Test INI file writing by running
    "Set Intensity" created in step 1    
5.  (Optional) Order the illuminations in a human readable format, otherwise settings
    get added ad-hoc and it's difficult to read the file.  To do this, run "Show 
    Values" button and set default laser key-value pairs for all laser illuminations.

User interaction
----------------
Button: `Set Laser Intensity`

> 1.  Adjust intensity slider
> 2.  Click "OK"

Button: `Show Values`

> Opens notepad to show INI file.  Useful to copy and paste metadata

<!-- content below automatically generated by C:\MM\app\mmproc\journals\doc_jnl.py -->
Source Code
-----------
set_intensity.jnl:
```python
'''
Record laser power on a per-illumination basis.  [Requires] illumination name
must end in 3 digits of laser wavelength
'''

# Get the current laser intensity if it exists.  This is valuable feedback for
# the user to see what the intensity was before changing
Run_Journal(50 C:\MM\app\mmproc\journals\laser\_get_intensity.jnl)

# Extract wavelength from illumination name.  If the channel does not end in 3
# digits, the prompt defaults to the first component name
wavelength_STR = RIGHT(current_illumination_name,3)
wavelength = VAL(wavelength_STR)

# Prompt the user to set the correct intensity
Component_Control(wavelength_STR + " Laser Intensity" = 19 405 Laser Intensity,
                  Position = 51)

# Record intensity from component control into a variable
if wavelength = 405:,
        laser_intensity = Component.405_Laser_Intensity.Position
,
    else:
    if wavelength = 445:,
        laser_intensity = Component.445_Laser_Intensity.Position
,
    else:
    if wavelength = 488:,
        laser_intensity = Component.488_Laser_Intensity.Position
,
    else:
    if wavelength = 515:,
        laser_intensity = Component.515_Laser_Intensity.Position
,
    else:
    if wavelength = 561:,
        laser_intensity = Component.561_Laser_Intensity.Position
,
    else:






# Store in INI file for persistent storage
Write_INI_String(IniPath = 49 C:\MM\app\mmproc\journals\illumination_values.ini,
                 IniSection = 17 Laser Intensities,
                 current_illumination_name = 12 Confocal 488,
                 laser_intensity = 9 20.000000)
```

show_values.jnl:
```python
'''
Record laser power on a per-illumination basis.  [Requires] illumination name
must end in 3 digits of laser wavelength
'''

# Open INI file
Run_Program(57 notepad C:\MM\app\mmproc\journals\illumination_values.ini,
            1,
            FALSE)
```

_get_intensity.jnl:
```python
'''
Retrieve laser power for the current illumination.  [Requires] illumination
name must end in 3 digits of laser wavelength
'''

# Get the current illumination name.  This will be used to store the laser
# power
current_illumination_name = Device.Illumination.Setting

# Extract wavelength from illumination name.  If the channel does not end in 3
# digits, the prompt defaults to the first component name
wavelength_STR = RIGHT(current_illumination_name,3)
wavelength = VAL(wavelength_STR)

# Read value from INI file
Get_INI_String(IniPath = 49 C:\MM\app\mmproc\journals\illumination_values.ini,
               IniSection = 17 Laser Intensities,
               current_illumination_name = 12 Confocal 488,
               DefaultValue = 4 None,
               Variable = 19 laser_intensity_STR)

# Set component value
if NOT(laser_intensity_STR = "None"):,
        laser_intensity = VAL(laser_intensity_STR)
    if wavelength = 405:,
        Component.405_Laser_Intensity.Position = laser_intensity
,
    else:
    if wavelength = 445:,
        Component.445_Laser_Intensity.Position = laser_intensity
,
    else:
    if wavelength = 488:,
        Component.488_Laser_Intensity.Position = laser_intensity
,
    else:
    if wavelength = 515:,
        Component.515_Laser_Intensity.Position = laser_intensity
,
    else:
    if wavelength = 561:,
        Component.561_Laser_Intensity.Position = laser_intensity
,
    else:





,
    else:
    # We could not read the laser intesity.  Leave the laser intensity alone

```
