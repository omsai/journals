Adjust selected illumination laser intensity
============================================

Necessity
---------
Changing the laser intensity of a channel in Metamorph 7 is cumbersome:

1.  Open the "Devices > Configure Illumination" window
2.  Find the slider from the list of all device properties
3.  Edit the value, and click "Add / Replace"
4.  Confirm overwriting the existing value

Solution
--------
Metmorph doesn't allow you to record values to an illumination using journals.
Thus the workaround is to completely bypass saving the laser intensity in the
illumination and use an INI file.  Values are read from the INI file by enabling
"Run journal when changing illumination setting" for each laser illumination.

Journals here require the user only to have their illumination of choice
in the drop down menu, run `set_intensity.jnl` and set the single slider in
the modal window.  The journal automatically "knows" what laser wavelength
you want to edit by reading the last 3 digits of the illumination name.

Warning!
--------
Images and experiments will not show laser powers.

Possible workarounds:

1.  Append INI file information to the image or experiment "custom" metadata field
    (assuming such a thing exists)
2.  Copy the INI file to the location where the image or experiment files are saved

Installation
------------
1.  Add buttons `set_intensity.jnl` and `show_values.jnl` to the journal taskbar
    or drop-in toolbar
2.  Rename all laser channels which this journal should operate on
    have their laser wavelength to be edited set to the last 3 digits
    of the channel name like "Confocal 488" or "TIRF640"
3.  Check "Run journal when changing illumination setting" for each laser
    illumination.

User interaction
----------------
Button: `Set Laser Intensity`

1.  Adjust intensity slider
2.  Click "OK"

Button: `Show Values`

Opens notepad to show INI file.  Useful to copy and paste metadata

<!-- content below automatically generated by doc_jnl.py -->
Source Code
-----------
laser_get_all_intensities.jnl:
```python
'''
Read INI file and apply all laser intensities
'''

# Read variables from INI file
Get_INI_String(18 C:\MM\Confocal.INI,
               17 Laser Intensities,
               9 Laser_405,
               1 0,
               16 intensity_of_405)
Get_INI_String(18 C:\MM\Confocal.INI,
               17 Laser Intensities,
               9 Laser_445,
               1 0,
               16 intensity_of_445)
Get_INI_String(18 C:\MM\Confocal.INI,
               17 Laser Intensities,
               9 Laser_488,
               1 0,
               16 intensity_of_488)
Get_INI_String(18 C:\MM\Confocal.INI,
               17 Laser Intensities,
               9 Laser_515,
               1 0,
               16 intensity_of_515)
Get_INI_String(18 C:\MM\Confocal.INI,
               17 Laser Intensities,
               9 Laser_561,
               1 0,
               16 intensity_of_561)

# Apply intensities to lasers
Component_Control(Component Name = 29 ALC Laser 1 Intensity (405nm),
                  intensity_of_405 = 0)
Component_Control(Component Name = 30 ALC Laser 2 Intensity (445 nm),
                  intensity_of_445 = 0)
Component_Control(Component Name = 30 ALC Laser 3 Intensity (488 nm),
                  intensity_of_488 = 0)
Component_Control(Component Name = 30 ALC Laser 4 Intensity (515 nm),
                  intensity_of_515 = 0)
Component_Control(Component Name = 30 ALC Laser 5 Intensity (561 nm),
                  intensity_of_561 = 0)
```

laser_set_405_intensity.jnl:
```python
'''
Read INI file with laser intensities, set laser intensity, and save back to
INI file
'''

# Run journal which reads from INI file and applies all laser intensities
Run_Journal(55 C:\MM\app\mmproc\journals\laser_get_all_intensities.jnl)

# Have the user set the correct laser intensity
Component_Control(29 ALC Laser 1 Intensity (405nm),
                  0)

# Record the current intensity into a variable
current_laser_intensity = Component.ALC_Laser_1_Intensity__405nm_.Position

# Save this variable to INI file
Write_INI_String(IniPath = 18 C:\MM\Confocal.INI,
                 IniSection = 17 Laser Intensities,
                 IniKey = 9 Laser_405,
                 current_laser_intensity = 19 journal_time_point3)
```

laser_set_445_intensity.jnl:
```python
'''
Read INI file with laser intensities, set laser intensity, and save back to
INI file
'''

# Run journal which reads from INI file and applies all laser intensities
Run_Journal(55 C:\MM\app\mmproc\journals\laser_get_all_intensities.jnl)

# Have the user set the correct laser intensity
Component_Control(30 ALC Laser 2 Intensity (445 nm),
                  0)

# Record the current intensity into a variable
current_laser_intensity = Component.ALC_Laser_2_Intensity__445_nm_.Position

# Save this variable to INI file
Write_INI_String(IniPath = 18 C:\MM\Confocal.INI,
                 IniSection = 17 Laser Intensities,
                 IniKey = 9 Laser_445,
                 current_laser_intensity = 19 journal_time_point3)
```

laser_set_488_intensity.jnl:
```python
'''
Read INI file with laser intensities, set laser intensity, and save back to
INI file
'''

# Run journal which reads from INI file and applies all laser intensities
Run_Journal(55 C:\MM\app\mmproc\journals\laser_get_all_intensities.jnl)

# Have the user set the correct laser intensity
Component_Control(30 ALC Laser 3 Intensity (488 nm),
                  0)

# Record the current intensity into a variable
current_laser_intensity = Component.ALC_Laser_3_Intensity__488_nm_.Position

# Save this variable to INI file
Write_INI_String(IniPath = 18 C:\MM\Confocal.INI,
                 IniSection = 17 Laser Intensities,
                 IniKey = 9 Laser_488,
                 current_laser_intensity = 19 journal_time_point3)
```

laser_set_515_intensity.jnl:
```python
'''
Read INI file with laser intensities, set laser intensity, and save back to
INI file
'''

# Run journal which reads from INI file and applies all laser intensities
Run_Journal(55 C:\MM\app\mmproc\journals\laser_get_all_intensities.jnl)

# Have the user set the correct laser intensity
Component_Control(30 ALC Laser 4 Intensity (515 nm),
                  0)

# Record the current intensity into a variable
current_laser_intensity = Component.ALC_Laser_4_Intensity__515_nm_.Position

# Save this variable to INI file
Write_INI_String(IniPath = 18 C:\MM\Confocal.INI,
                 IniSection = 17 Laser Intensities,
                 IniKey = 9 Laser_515,
                 current_laser_intensity = 19 journal_time_point3)
```

laser_set_561_intensity.jnl:
```python
'''
Read INI file with laser intensities, set laser intensity, and save back to
INI file
'''

# Run journal which reads from INI file and applies all laser intensities
Run_Journal(55 C:\MM\app\mmproc\journals\laser_get_all_intensities.jnl)

# Have the user set the correct laser intensity
Component_Control(30 ALC Laser 5 Intensity (561 nm),
                  0)

# Record the current intensity into a variable
current_laser_intensity = Component.ALC_Laser_5_Intensity__561_nm_.Position

# Save this variable to INI file
Write_INI_String(IniPath = 18 C:\MM\Confocal.INI,
                 IniSection = 17 Laser Intensities,
                 IniKey = 9 Laser_561,
                 current_laser_intensity = 19 journal_time_point3)
```
<!-- content below automatically generated by C:\MM\app\mmproc\journals\doc_jnl.py -->
Source Code
-----------
set_intensity.jnl:
```python
'''
Record laser power on a per-illumination basis.  [Requires] illumination name
must end in 3 digits of laser wavelength
'''

# Get the current laser intensity if it exists.  This is valuable feedback for
# the user to see what the intensity was before changing
Run_Journal(50 C:\MM\app\mmproc\journals\laser\_get_intensity.jnl)

# Extract wavelength from illumination name.  If the channel does not end in 3
# digits, the prompt defaults to the first component name
wavelength_STR = RIGHT(current_illumination_name,3)
wavelength = VAL(wavelength_STR)

# Prompt the user to set the correct intensity
Component_Control(wavelength_STR + " Laser Intensity" = 19 405 Laser Intensity,
                  Position = 51)

# Record intensity from component control into a variable
if wavelength = 405:,
        laser_intensity = Component.405_Laser_Intensity.Position
,
    else:
    if wavelength = 445:,
        laser_intensity = Component.445_Laser_Intensity.Position
,
    else:
    if wavelength = 488:,
        laser_intensity = Component.488_Laser_Intensity.Position
,
    else:
    if wavelength = 515:,
        laser_intensity = Component.515_Laser_Intensity.Position
,
    else:
    if wavelength = 561:,
        laser_intensity = Component.561_Laser_Intensity.Position
,
    else:






# Store in INI file for persistent storage
Write_INI_String(IniPath = 49 C:\MM\app\mmproc\journals\illumination_values.ini,
                 IniSection = 17 Laser Intensities,
                 current_illumination_name = 12 Confocal 488,
                 laser_intensity = 9 20.000000)
```

show_values.jnl:
```python
'''
Record laser power on a per-illumination basis.  [Requires] illumination name
must end in 3 digits of laser wavelength
'''

# Open INI file
Run_Program(57 notepad C:\MM\app\mmproc\journals\illumination_values.ini,
            1,
            FALSE)
```

_get_intensity.jnl:
```python
'''
Retrieve laser power for the current illumination.  [Requires] illumination
name must end in 3 digits of laser wavelength
'''

# Get the current illumination name.  This will be used to store the laser
# power
current_illumination_name = Device.Illumination.Setting

# Extract wavelength from illumination name.  If the channel does not end in 3
# digits, the prompt defaults to the first component name
wavelength_STR = RIGHT(current_illumination_name,3)
wavelength = VAL(wavelength_STR)

# Read value from INI file
Get_INI_String(IniPath = 49 C:\MM\app\mmproc\journals\illumination_values.ini,
               IniSection = 17 Laser Intensities,
               current_illumination_name = 12 Confocal 488,
               DefaultValue = 4 None,
               Variable = 19 laser_intensity_STR)

# Set component value
if NOT(laser_intensity_STR = "None"):,
        laser_intensity = VAL(laser_intensity_STR)
    if wavelength = 405:,
        Component.405_Laser_Intensity.Position = laser_intensity
,
    else:
    if wavelength = 445:,
        Component.445_Laser_Intensity.Position = laser_intensity
,
    else:
    if wavelength = 488:,
        Component.488_Laser_Intensity.Position = laser_intensity
,
    else:
    if wavelength = 515:,
        Component.515_Laser_Intensity.Position = laser_intensity
,
    else:
    if wavelength = 561:,
        Component.561_Laser_Intensity.Position = laser_intensity
,
    else:





,
    else:
    # We could not read the laser intesity.  Leave the laser intensity alone

```
