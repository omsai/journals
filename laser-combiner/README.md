Laser Combiner
==============

Necessity
---------
To change the laser intensity of a channel, Metamorph 7 is cumbersome:
1.  Open the "Devices > Configure Illumination" window
2.  Find the slider from the list of all device properties
3.  Edit the value, and click "Add / Replace"
4.  Confirm overwriting the existing value

Solution
--------
Metmorph doesn't allow you to record values to an illumination using journals.
Thus the workaround is to completely bypass saving the laser intensity in the
illumination and use an INI file.  Values are read from the INI file by enabling
"Run journal when changing illumination setting" for each laser illumination.

Journals here require the user only to have their illumination of choice
in the drop down menu, run `set_intensity.jnl` and set the single slider in
the modal window.  The journal automatically "knows" what laser wavelength
you want to edit by reading the last 3 digits of the illumination name.

Installation
------------
1.  Add `set_intensity.jnl` to the journal taskbar or a drop-in toolbar
2.  Rename all laser channels which this journal should operate on
    have their laser wavelength to be edited set to the last 3 digits
    of the channel name like "Confocal 488" or "TIRF640"
3.  Check "Run journal when changing illumination setting" for each laser
    illumination.

User interaction
----------------
1.  Click on the button created in setup #1
2.  Adjust intensity slider
3.  Click "OK"

<!-- content below automatically generated by doc_jnl.py -->
Source Code
-----------
laser_get_all_intensities.jnl:
```python
'''
Read INI file and apply all laser intensities
'''

# Read variables from INI file
Get_INI_String(18 C:\MM\Confocal.INI,
               17 Laser Intensities,
               9 Laser_405,
               1 0,
               16 intensity_of_405)
Get_INI_String(18 C:\MM\Confocal.INI,
               17 Laser Intensities,
               9 Laser_445,
               1 0,
               16 intensity_of_445)
Get_INI_String(18 C:\MM\Confocal.INI,
               17 Laser Intensities,
               9 Laser_488,
               1 0,
               16 intensity_of_488)
Get_INI_String(18 C:\MM\Confocal.INI,
               17 Laser Intensities,
               9 Laser_515,
               1 0,
               16 intensity_of_515)
Get_INI_String(18 C:\MM\Confocal.INI,
               17 Laser Intensities,
               9 Laser_561,
               1 0,
               16 intensity_of_561)

# Apply intensities to lasers
Component_Control(Component Name = 29 ALC Laser 1 Intensity (405nm),
                  intensity_of_405 = 0)
Component_Control(Component Name = 30 ALC Laser 2 Intensity (445 nm),
                  intensity_of_445 = 0)
Component_Control(Component Name = 30 ALC Laser 3 Intensity (488 nm),
                  intensity_of_488 = 0)
Component_Control(Component Name = 30 ALC Laser 4 Intensity (515 nm),
                  intensity_of_515 = 0)
Component_Control(Component Name = 30 ALC Laser 5 Intensity (561 nm),
                  intensity_of_561 = 0)
```

laser_set_405_intensity.jnl:
```python
'''
Read INI file with laser intensities, set laser intensity, and save back to
INI file
'''

# Run journal which reads from INI file and applies all laser intensities
Run_Journal(55 C:\MM\app\mmproc\journals\laser_get_all_intensities.jnl)

# Have the user set the correct laser intensity
Component_Control(29 ALC Laser 1 Intensity (405nm),
                  0)

# Record the current intensity into a variable
current_laser_intensity = Component.ALC_Laser_1_Intensity__405nm_.Position

# Save this variable to INI file
Write_INI_String(IniPath = 18 C:\MM\Confocal.INI,
                 IniSection = 17 Laser Intensities,
                 IniKey = 9 Laser_405,
                 current_laser_intensity = 19 journal_time_point3)
```

laser_set_445_intensity.jnl:
```python
'''
Read INI file with laser intensities, set laser intensity, and save back to
INI file
'''

# Run journal which reads from INI file and applies all laser intensities
Run_Journal(55 C:\MM\app\mmproc\journals\laser_get_all_intensities.jnl)

# Have the user set the correct laser intensity
Component_Control(30 ALC Laser 2 Intensity (445 nm),
                  0)

# Record the current intensity into a variable
current_laser_intensity = Component.ALC_Laser_2_Intensity__445_nm_.Position

# Save this variable to INI file
Write_INI_String(IniPath = 18 C:\MM\Confocal.INI,
                 IniSection = 17 Laser Intensities,
                 IniKey = 9 Laser_445,
                 current_laser_intensity = 19 journal_time_point3)
```

laser_set_488_intensity.jnl:
```python
'''
Read INI file with laser intensities, set laser intensity, and save back to
INI file
'''

# Run journal which reads from INI file and applies all laser intensities
Run_Journal(55 C:\MM\app\mmproc\journals\laser_get_all_intensities.jnl)

# Have the user set the correct laser intensity
Component_Control(30 ALC Laser 3 Intensity (488 nm),
                  0)

# Record the current intensity into a variable
current_laser_intensity = Component.ALC_Laser_3_Intensity__488_nm_.Position

# Save this variable to INI file
Write_INI_String(IniPath = 18 C:\MM\Confocal.INI,
                 IniSection = 17 Laser Intensities,
                 IniKey = 9 Laser_488,
                 current_laser_intensity = 19 journal_time_point3)
```

laser_set_515_intensity.jnl:
```python
'''
Read INI file with laser intensities, set laser intensity, and save back to
INI file
'''

# Run journal which reads from INI file and applies all laser intensities
Run_Journal(55 C:\MM\app\mmproc\journals\laser_get_all_intensities.jnl)

# Have the user set the correct laser intensity
Component_Control(30 ALC Laser 4 Intensity (515 nm),
                  0)

# Record the current intensity into a variable
current_laser_intensity = Component.ALC_Laser_4_Intensity__515_nm_.Position

# Save this variable to INI file
Write_INI_String(IniPath = 18 C:\MM\Confocal.INI,
                 IniSection = 17 Laser Intensities,
                 IniKey = 9 Laser_515,
                 current_laser_intensity = 19 journal_time_point3)
```

laser_set_561_intensity.jnl:
```python
'''
Read INI file with laser intensities, set laser intensity, and save back to
INI file
'''

# Run journal which reads from INI file and applies all laser intensities
Run_Journal(55 C:\MM\app\mmproc\journals\laser_get_all_intensities.jnl)

# Have the user set the correct laser intensity
Component_Control(30 ALC Laser 5 Intensity (561 nm),
                  0)

# Record the current intensity into a variable
current_laser_intensity = Component.ALC_Laser_5_Intensity__561_nm_.Position

# Save this variable to INI file
Write_INI_String(IniPath = 18 C:\MM\Confocal.INI,
                 IniSection = 17 Laser Intensities,
                 IniKey = 9 Laser_561,
                 current_laser_intensity = 19 journal_time_point3)
```
